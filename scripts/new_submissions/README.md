## Скрипты для оповещения о новых посылках

Для работы всех скриптов необходимо авторизоввться с правами проверяющего:

```bash
kks auth --judge
```

### `src/utils/submissions.py`

В файле содержатся вспомогательные функции для получения списка новых посылок.

- `new_submissions()` - возвращает список новых посылок в хронологическом порядке.
- `save_last_id(submissions, id_file=None)` - обновляет сохранённый id последней посылки. В качестве аргумента `submissions` должен передаваться результат вызова `new_submissions()`.

### `legacy/telegram_simple_post.py`

При запуске отправляет сообщения о новых посылках в телеграм-чат/канал.

Используются переменные окружения: `EJUDGE_TELEGRAM_TOKEN` - токен для бота, `EJUDGE_TELEGRAM_CHAT` - id чата/канала.

### `legacy/telegram_bot.py` (старая версия)

Запускает telegram-бота, который раз в час отправляет сообщения о новых посылках. К сообщениям прикрепляются кнопки (для возможности распределения посылок между проверяющими).

Для запуска требуется `python-telegram-bot`

### `src/telegram_bot.py`

Обновлённый бот. Отличия от 1-й версии:
- При проверке всех посылок старые сообщения удаляются, чтобы не засорять чат/канал.
- Бот хранит статистику по проверенным посылкам, поддерживается выгрузка в CSV.
- Для повторных посылок (с исправлениями реджектов) добавляется информация о проверяющем, от которого был получен реджект.

Используемые переменные окружения:
- `EJ_SUB_TELEGRAM_TOKEN` - токен для бота
- `EJ_SUB_TELEGRAM_CHAT` - id чата/канала
- `EJ_SUB_DB_FILE` - файл для базы данных бота (по умолчанию `caos.db` в родительской директории скрипта)

Для запуска бота требуется установленная библиотека sqlite3.
