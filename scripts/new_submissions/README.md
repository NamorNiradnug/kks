## Бот для ревью посылок

Бот раз в час отправляет уведомления о новых посылках, ожидающих проверки, в телеграм-чат/канал.
К сообщениям прикрепляются кнопки (для возможности распределения посылок между проверяющими и удаления сообщений после проверки всех посылок).
Для повторных посылок (с исправлениями реджектов) добавляется информация о проверяющем, от которого был получен реджект.

В ЛС поддерживаются команды:
- `/get RUN_ID` - узнать, кто проверял посылку.
- `/take RUN_ID` - пометить посылку, которой нет в БД бота, как проверенную.
- `/stats` - статистика по количеству проверенных посылок.
- `/dump` - выгрузить таблицу проверенных посылок в формате CSV.

Бот использует конфиг в формате yaml, пример - [config.sample](config.sample)

### Запуск в докер-контейнере

```shell
./build.sh
./run.sh ./config
```

Или можно воспользоваться готовым образом:

```shell
IMAGE=vvd170501/caos-submissions-bot ./run.sh ./config
```

### Запуск на хосте

В конфиге нужно поменять путь к БД (`db_file`) на такой, к которому у пользователя есть доступ на чтение и запись.

```shell
pip install ../..  # kks
pip install -r src/requirements.txt
./src/telegram_bot.py ./config
```

## Legacy-скрипты

**Скрипты писались для старой версии kks, больше не поддерживаются и могут не работать.**

Для работы всех скриптов необходимо авторизоввться с правами проверяющего:

```shell
kks auth --judge``

### `legacy/telegram_simple_post.py`

При запуске отправляет сообщения о новых посылках в телеграм-чат/канал. Можно запускать через cron.

Используются переменные окружения: `EJUDGE_TELEGRAM_TOKEN` - токен для бота, `EJUDGE_TELEGRAM_CHAT` - id чата/канала.

### `legacy/telegram_bot.py` (старая версия)

Запускает telegram-бота, который раз в час отправляет сообщения о новых посылках. К сообщениям прикрепляются кнопки (для возможности распределения посылок между проверяющими).

Для запуска требуется `python-telegram-bot`
